<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Einstellungen</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #333; margin-bottom: 30px; }
        .section { background: white; border-radius: 8px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #444; margin-bottom: 20px; border-bottom: 2px solid #4285f4; padding-bottom: 10px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
        input[type="text"], input[type="number"], input[type="password"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        input[type="color"] { width: 60px; height: 40px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; }
        input[type="checkbox"] { width: 18px; height: 18px; margin-right: 8px; vertical-align: middle; }
        button { background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500; }
        button:hover { background: #3367d6; }
        button.danger { background: #dc2626; }
        button.danger:hover { background: #b91c1c; }
        button.secondary { background: #6b7280; }
        button.secondary:hover { background: #4b5563; }
        .calendar-list, .image-list { margin-top: 15px; }
        .calendar-item, .image-item { background: #f9f9f9; padding: 15px; border-radius: 4px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .calendar-info { flex: 1; }
        .calendar-name { font-weight: 600; margin-bottom: 5px; }
        .calendar-url { font-size: 12px; color: #666; word-break: break-all; }
        .color-indicator { width: 20px; height: 20px; border-radius: 50%; margin-right: 10px; }
        .actions { display: flex; gap: 10px; }
        .success-message { background: #10b981; color: white; padding: 10px 15px; border-radius: 4px; margin-bottom: 20px; display: none; }
        .error-message { background: #dc2626; color: white; padding: 10px 15px; border-radius: 4px; margin-bottom: 20px; display: none; }
        .info-box { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .info-box.warning { background: #fff3cd; border-left-color: #f59e0b; }
        .info-box.success { background: #d1fae5; border-left-color: #10b981; }
        .info-box h3 { color: #1976d2; margin-bottom: 10px; }
        .info-box.warning h3 { color: #b45309; }
        .info-box.success h3 { color: #047857; }
        .info-box p { color: #555; line-height: 1.6; }
        .info-box code { background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .back-link { display: inline-block; margin-bottom: 20px; color: #4285f4; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .checkbox-item { display: flex; align-items: center; background: #f9f9f9; padding: 8px 12px; border-radius: 4px; }
        .checkbox-item label { margin-bottom: 0; cursor: pointer; display: flex; align-items: center; }
        .zone-description { font-size: 12px; color: #666; margin-top: 5px; }
        .preview-box { background: #1f2937; color: white; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .preview-box h4 { margin-bottom: 10px; color: #fbbf24; }
        .preview-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 14px; }
        .preview-item:last-child { border-bottom: none; }
        .preview-icon { font-size: 1.2rem; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Zur√ºck zum Dashboard</a>
        <h1>Dashboard Einstellungen</h1>
        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <!-- Abfuhr-Einstellungen -->
        <div class="section">
            <h2>üóëÔ∏è Abfuhr-Einstellungen (Basel-Stadt)</h2>
            <div class="info-box success">
                <h3>Stadtreinigung Basel-Stadt Integration</h3>
                <p>
                    Das Dashboard zeigt automatisch die n√§chsten Abfuhrtermine f√ºr deine Zone an.
                    Die Daten stammen von der offiziellen <a href="https://data.bs.ch/explore/dataset/100096/" target="_blank">Open Data API des Kantons Basel-Stadt</a>.
                </p>
            </div>
            <div class="form-group">
                <label><input type="checkbox" id="abfuhrEnabled" checked> Abfuhr-Erinnerungen aktivieren</label>
            </div>
            <div class="grid">
                <div class="form-group">
                    <label>Abfuhrzone</label>
                    <select id="abfuhrZone">
                        <option value="A">Zone A - Altstadt Grossbasel, Vorst√§dte</option>
                        <option value="B">Zone B - Clara, Wettstein, Hirzbrunnen</option>
                        <option value="C">Zone C - Breite, St. Alban, Gundeldingen</option>
                        <option value="D">Zone D - Bruderholz, Bachletten</option>
                        <option value="E">Zone E - Gotthelf, Iselin, St. Johann</option>
                        <option value="F">Zone F - Matth√§us, Klybeck, Kleinh√ºningen</option>
                        <option value="G">Zone G - Rosental, Erlenmatt</option>
                        <option value="GUF">Zone GUF - Rosental Unterflur</option>
                        <option value="H">Zone H - Riehen, Bettingen</option>
                    </select>
                    <div class="zone-description">W√§hle die Zone f√ºr deine Adresse. <a href="https://www.geo.bs.ch/abfuhrzonen" target="_blank">Zone nachschlagen</a></div>
                </div>
                <div class="form-group">
                    <label>Erinnerung X Tage vorher</label>
                    <select id="abfuhrReminderDays">
                        <option value="0">Am Abfuhrtag</option>
                        <option value="1" selected>1 Tag vorher (empfohlen)</option>
                        <option value="2">2 Tage vorher</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Angezeigte Abfuhrtypen</label>
                <div class="checkbox-group" id="abfuhrTypesGroup">
                    <div class="checkbox-item"><label><input type="checkbox" value="Kehricht" checked> üóëÔ∏è Kehricht</label></div>
                    <div class="checkbox-item"><label><input type="checkbox" value="Papier" checked> üì∞ Papier</label></div>
                    <div class="checkbox-item"><label><input type="checkbox" value="Karton" checked> üì¶ Karton</label></div>
                    <div class="checkbox-item"><label><input type="checkbox" value="Gr√ºngut" checked> üåø Gr√ºngut</label></div>
                    <div class="checkbox-item"><label><input type="checkbox" value="Metall" checked> üîß Metall</label></div>
                    <div class="checkbox-item"><label><input type="checkbox" value="Sperrgut" checked> üõãÔ∏è Sperrgut</label></div>
                </div>
            </div>
            <button onclick="saveAbfuhrSettings()">Abfuhr-Einstellungen speichern</button>
            <button class="secondary" onclick="refreshAbfuhrCache()" style="margin-left: 10px;">Cache aktualisieren</button>
            <div class="preview-box" id="abfuhrPreview">
                <h4>üóìÔ∏è N√§chste Abfuhren</h4>
                <div id="abfuhrPreviewContent">Lade Vorschau...</div>
            </div>
        </div>

        <!-- Wetter-Einstellungen -->
        <div class="section">
            <h2>üå§Ô∏è Wetter-Einstellungen</h2>
            <div class="info-box">
                <h3>OpenWeatherMap API-Schl√ºssel</h3>
                <p>Du ben√∂tigst einen kostenlosen API-Schl√ºssel von <a href="https://openweathermap.org/api" target="_blank">OpenWeatherMap</a>.</p>
            </div>
            <div class="form-group">
                <label>API-Schl√ºssel</label>
                <input type="text" id="weatherApiKey" placeholder="Dein OpenWeatherMap API-Schl√ºssel">
            </div>
            <div class="grid">
                <div class="form-group"><label>Stadt</label><input type="text" id="weatherCity" value="Basel"></div>
                <div class="form-group"><label>Land (ISO-Code)</label><input type="text" id="weatherCountry" value="CH"></div>
            </div>
            <div class="grid">
                <div class="form-group"><label>Breitengrad</label><input type="number" step="0.0001" id="weatherLat" value="47.5596"></div>
                <div class="form-group"><label>L√§ngengrad</label><input type="number" step="0.0001" id="weatherLon" value="7.5886"></div>
            </div>
            <button onclick="saveWeatherSettings()">Wetter-Einstellungen speichern</button>
        </div>

        <!-- Google Kalender -->
        <div class="section">
            <h2>üìÖ Google Kalender</h2>
            <div class="info-box">
                <h3>Google Kalender einrichten</h3>
                <p>1. √ñffne <a href="https://calendar.google.com" target="_blank">Google Calendar</a><br>
                2. Klicke auf die drei Punkte neben dem Kalender ‚Üí "Einstellungen und Freigabe"<br>
                3. Scrolle zu "Kalenderadresse" und kopiere die "Geheime Adresse im iCal-Format"</p>
            </div>
            <div class="form-group"><label>Kalendername</label><input type="text" id="googleCalendarName" placeholder="z.B. Familie, Arbeit"></div>
            <div class="form-group"><label>iCal URL</label><input type="text" id="googleCalendarUrl" placeholder="https://calendar.google.com/calendar/ical/..."></div>
            <div class="form-group"><label>Farbe</label><input type="color" id="googleCalendarColor" value="#4285f4"></div>
            <button onclick="addGoogleCalendar()">Google Kalender hinzuf√ºgen</button>
            <div class="calendar-list" id="googleCalendarList"></div>
        </div>

        <!-- iCloud Kalender -->
        <div class="section">
            <h2>üçé iCloud Kalender</h2>
            <div class="info-box">
                <h3>iCloud Kalender einrichten</h3>
                <p>1. Gehe zu <a href="https://www.icloud.com/calendar" target="_blank">iCloud.com/calendar</a><br>
                2. Aktiviere "√ñffentlicher Kalender" und kopiere die URL<br>
                3. √Ñndere <code>webcal://</code> zu <code>https://</code></p>
            </div>
            <div class="form-group"><label>Kalendername</label><input type="text" id="icloudCalendarName" placeholder="z.B. Familie"></div>
            <div class="form-group"><label>Kalender URL</label><input type="text" id="icloudCalendarUrl" placeholder="https://p01-caldav.icloud.com/..."></div>
            <div class="form-group"><label>Farbe</label><input type="color" id="icloudCalendarColor" value="#ff2d55"></div>
            <button onclick="addIcloudCalendar()">iCloud Kalender hinzuf√ºgen</button>
            <div class="calendar-list" id="icloudCalendarList"></div>
        </div>

        <!-- Hintergrundbilder -->
        <div class="section">
            <h2>üñºÔ∏è Hintergrundbilder</h2>
            <div class="form-group">
                <label>Bildquelle</label>
                <select id="imageSourceType">
                    <option value="local_folder">Lokaler Ordner (empfohlen)</option>
                    <option value="url">Einzelne Bild-URL</option>
                </select>
            </div>
            <div class="form-group"><label>Name</label><input type="text" id="imageSourceName" placeholder="z.B. Familienfotos"></div>
            <div class="form-group" id="urlField"><label>URL</label><input type="text" id="imageSourceUrl" placeholder="https://..."></div>
            <div class="form-group" id="pathField" style="display:none;"><label>Pfad zum Ordner</label><input type="text" id="imageSourcePath" placeholder="/home/pi/bilder"></div>
            <button onclick="addImageSource()">Bildquelle hinzuf√ºgen</button>
            <div class="form-group" style="margin-top: 30px;">
                <label>Wechselintervall (Sekunden)</label>
                <input type="number" id="imageInterval" value="120" min="30">
            </div>
            <button onclick="saveImageSettings()">Bild-Einstellungen speichern</button>
            <div class="image-list" id="imageSourceList" style="margin-top: 20px;"></div>
        </div>

        <!-- Anzeige-Einstellungen -->
        <div class="section">
            <h2>‚öôÔ∏è Anzeige-Einstellungen</h2>
            <div class="grid">
                <div class="form-group">
                    <label>Sprache/Region</label>
                    <select id="displayLocale">
                        <option value="de-CH">Deutsch (Schweiz)</option>
                        <option value="de-DE">Deutsch (Deutschland)</option>
                        <option value="en-US">English (US)</option>
                        <option value="fr-CH">Fran√ßais (Suisse)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Zeitzone</label>
                    <select id="displayTimezone">
                        <option value="Europe/Zurich">Europe/Zurich</option>
                        <option value="Europe/Berlin">Europe/Berlin</option>
                        <option value="Europe/Paris">Europe/Paris</option>
                    </select>
                </div>
            </div>
            <button onclick="saveDisplaySettings()">Anzeige-Einstellungen speichern</button>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let config = {};

        async function loadConfig() {
            try {
                const response = await fetch(`${API_BASE}/api/config`);
                config = await response.json();
                
                document.getElementById('weatherApiKey').value = config.weather?.apiKey || '';
                document.getElementById('weatherCity').value = config.weather?.city || 'Basel';
                document.getElementById('weatherCountry').value = config.weather?.country || 'CH';
                document.getElementById('weatherLat').value = config.weather?.lat || 47.5596;
                document.getElementById('weatherLon').value = config.weather?.lon || 7.5886;
                document.getElementById('imageInterval').value = (config.images?.changeInterval / 1000) || 120;
                document.getElementById('displayLocale').value = config.display?.locale || 'de-CH';
                document.getElementById('displayTimezone').value = config.display?.timezone || 'Europe/Zurich';
                
                // Abfuhr-Einstellungen
                if (config.abfuhr) {
                    document.getElementById('abfuhrEnabled').checked = config.abfuhr.enabled !== false;
                    document.getElementById('abfuhrZone').value = config.abfuhr.zone || 'A';
                    document.getElementById('abfuhrReminderDays').value = config.abfuhr.reminderDaysBefore || 1;
                    
                    const types = config.abfuhr.showTypes || ['Kehricht', 'Papier', 'Karton', 'Gr√ºngut', 'Metall', 'Sperrgut'];
                    document.querySelectorAll('#abfuhrTypesGroup input[type="checkbox"]').forEach(cb => {
                        cb.checked = types.includes(cb.value);
                    });
                }
                
                renderCalendars();
                renderImageSources();
                loadAbfuhrPreview();
            } catch (error) {
                console.error('Fehler beim Laden der Konfiguration:', error);
            }
        }

        async function loadAbfuhrPreview() {
            try {
                const response = await fetch(`${API_BASE}/api/abfuhr`);
                const data = await response.json();
                const container = document.getElementById('abfuhrPreviewContent');
                
                if (!data.enabled || !data.upcoming || data.upcoming.length === 0) {
                    container.innerHTML = '<div style="opacity: 0.6;">Keine Abfuhren gefunden oder deaktiviert.</div>';
                    return;
                }
                
                const icons = { 'kehricht': 'üóëÔ∏è', 'papier': 'üì∞', 'karton': 'üì¶', 'gr√ºngut': 'üåø', 'grungut': 'üåø', 'metall': 'üîß', 'sperrgut': 'üõãÔ∏è' };
                const getIcon = (type) => { for (const [k, v] of Object.entries(icons)) if (type.toLowerCase().includes(k)) return v; return '‚ôªÔ∏è'; };
                
                container.innerHTML = data.upcoming.slice(0, 5).map(item => `
                    <div class="preview-item">
                        <span class="preview-icon">${getIcon(item.type)}</span>
                        <span style="flex: 1;">${item.type}</span>
                        <span style="opacity: 0.7;">${item.dateFormatted}</span>
                        <span style="background: ${item.daysUntil <= 1 ? '#f59e0b' : 'rgba(255,255,255,0.1)'}; padding: 2px 8px; border-radius: 10px; font-size: 12px;">
                            ${item.daysUntil === 0 ? 'Heute' : item.daysUntil === 1 ? 'Morgen' : item.daysUntil + ' Tage'}
                        </span>
                    </div>
                `).join('') + `<div style="font-size: 11px; opacity: 0.5; margin-top: 10px;">Zone ${data.zone} | Aktualisiert: ${data.lastUpdate ? new Date(data.lastUpdate).toLocaleString('de-CH') : 'Nie'}</div>`;
            } catch (error) {
                document.getElementById('abfuhrPreviewContent').innerHTML = '<div style="color: #f87171;">Fehler beim Laden der Vorschau</div>';
            }
        }

        async function saveAbfuhrSettings() {
            const showTypes = [];
            document.querySelectorAll('#abfuhrTypesGroup input[type="checkbox"]:checked').forEach(cb => showTypes.push(cb.value));
            
            try {
                await fetch(`${API_BASE}/api/abfuhr/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        enabled: document.getElementById('abfuhrEnabled').checked,
                        zone: document.getElementById('abfuhrZone').value,
                        reminderDaysBefore: parseInt(document.getElementById('abfuhrReminderDays').value),
                        showTypes: showTypes
                    })
                });
                showSuccess('Abfuhr-Einstellungen gespeichert');
                loadAbfuhrPreview();
            } catch (error) {
                showError('Fehler beim Speichern');
            }
        }

        async function refreshAbfuhrCache() {
            try {
                await fetch(`${API_BASE}/api/abfuhr/refresh`, { method: 'POST' });
                showSuccess('Cache wird aktualisiert...');
                setTimeout(loadAbfuhrPreview, 2000);
            } catch (error) {
                showError('Fehler beim Aktualisieren');
            }
        }

        function renderCalendars() {
            const googleList = document.getElementById('googleCalendarList');
            googleList.innerHTML = '';
            (config.calendars?.google || []).forEach(cal => {
                const div = document.createElement('div');
                div.className = 'calendar-item';
                div.innerHTML = `
                    <div style="display: flex; align-items: center; flex: 1;">
                        <div class="color-indicator" style="background: ${cal.color};"></div>
                        <div class="calendar-info">
                            <div class="calendar-name">${cal.name}</div>
                            <div class="calendar-url">${cal.url.substring(0, 50)}...</div>
                        </div>
                    </div>
                    <button class="danger" onclick="deleteCalendar('google', '${cal.id}')">L√∂schen</button>
                `;
                googleList.appendChild(div);
            });

            const icloudList = document.getElementById('icloudCalendarList');
            icloudList.innerHTML = '';
            (config.calendars?.icloud || []).forEach(cal => {
                const div = document.createElement('div');
                div.className = 'calendar-item';
                div.innerHTML = `
                    <div style="display: flex; align-items: center; flex: 1;">
                        <div class="color-indicator" style="background: ${cal.color};"></div>
                        <div class="calendar-info">
                            <div class="calendar-name">${cal.name}</div>
                            <div class="calendar-url">${cal.url.substring(0, 50)}...</div>
                        </div>
                    </div>
                    <button class="danger" onclick="deleteCalendar('icloud', '${cal.id}')">L√∂schen</button>
                `;
                icloudList.appendChild(div);
            });
        }

        async function saveWeatherSettings() {
            config.weather = {
                apiKey: document.getElementById('weatherApiKey').value,
                city: document.getElementById('weatherCity').value,
                country: document.getElementById('weatherCountry').value,
                lat: parseFloat(document.getElementById('weatherLat').value),
                lon: parseFloat(document.getElementById('weatherLon').value)
            };
            await saveConfig('Wetter-Einstellungen gespeichert');
        }

        async function addGoogleCalendar() {
            const name = document.getElementById('googleCalendarName').value;
            const url = document.getElementById('googleCalendarUrl').value;
            const color = document.getElementById('googleCalendarColor').value;
            if (!name || !url) { showError('Bitte alle Felder ausf√ºllen'); return; }
            try {
                await fetch(`${API_BASE}/api/calendars/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'google', name, url, color })
                });
                await loadConfig();
                document.getElementById('googleCalendarName').value = '';
                document.getElementById('googleCalendarUrl').value = '';
                showSuccess('Google Kalender hinzugef√ºgt');
            } catch (error) { showError('Fehler beim Hinzuf√ºgen'); }
        }

        async function addIcloudCalendar() {
            const name = document.getElementById('icloudCalendarName').value;
            const url = document.getElementById('icloudCalendarUrl').value;
            const color = document.getElementById('icloudCalendarColor').value;
            if (!name || !url) { showError('Bitte alle Felder ausf√ºllen'); return; }
            try {
                await fetch(`${API_BASE}/api/calendars/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'icloud', name, url, color })
                });
                await loadConfig();
                document.getElementById('icloudCalendarName').value = '';
                document.getElementById('icloudCalendarUrl').value = '';
                showSuccess('iCloud Kalender hinzugef√ºgt');
            } catch (error) { showError('Fehler beim Hinzuf√ºgen'); }
        }

        async function deleteCalendar(type, id) {
            if (!confirm('Kalender wirklich l√∂schen?')) return;
            try {
                await fetch(`${API_BASE}/api/calendars/${type}/${id}`, { method: 'DELETE' });
                await loadConfig();
                showSuccess('Kalender gel√∂scht');
            } catch (error) { showError('Fehler beim L√∂schen'); }
        }

        async function saveImageSettings() {
            config.images.changeInterval = parseInt(document.getElementById('imageInterval').value) * 1000;
            await saveConfig('Bild-Einstellungen gespeichert');
        }

        async function addImageSource() {
            const type = document.getElementById('imageSourceType').value;
            const name = document.getElementById('imageSourceName').value;
            const url = type !== 'local_folder' ? document.getElementById('imageSourceUrl').value : '';
            const path = type === 'local_folder' ? document.getElementById('imageSourcePath').value : '';
            if (!name || (!url && !path)) { showError('Bitte alle Felder ausf√ºllen'); return; }
            try {
                await fetch(`${API_BASE}/api/images/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type, name, url, path })
                });
                await loadConfig();
                document.getElementById('imageSourceName').value = '';
                document.getElementById('imageSourceUrl').value = '';
                document.getElementById('imageSourcePath').value = '';
                showSuccess('Bildquelle hinzugef√ºgt');
            } catch (error) { showError('Fehler beim Hinzuf√ºgen'); }
        }

        async function deleteImageSource(id) {
            if (!confirm('Bildquelle wirklich l√∂schen?')) return;
            try {
                await fetch(`${API_BASE}/api/images/${id}`, { method: 'DELETE' });
                await loadConfig();
                showSuccess('Bildquelle gel√∂scht');
            } catch (error) { showError('Fehler beim L√∂schen'); }
        }

        function renderImageSources() {
            const list = document.getElementById('imageSourceList');
            list.innerHTML = '';
            (config.images?.sources || []).forEach(source => {
                const div = document.createElement('div');
                div.className = 'image-item';
                div.innerHTML = `
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${source.name}</div>
                        <div style="font-size: 12px; color: #666;">${source.type === 'local_folder' ? 'Ordner: ' + source.path : source.url?.substring(0, 50) + '...'}</div>
                    </div>
                    <button class="danger" onclick="deleteImageSource('${source.id}')">L√∂schen</button>
                `;
                list.appendChild(div);
            });
        }

        async function saveDisplaySettings() {
            config.display = {
                locale: document.getElementById('displayLocale').value,
                timezone: document.getElementById('displayTimezone').value
            };
            await saveConfig('Anzeige-Einstellungen gespeichert');
        }

        async function saveConfig(message) {
            try {
                await fetch(`${API_BASE}/api/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                showSuccess(message);
            } catch (error) { showError('Fehler beim Speichern'); }
        }

        function showSuccess(message) {
            const el = document.getElementById('successMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const typeSelect = document.getElementById('imageSourceType');
            typeSelect.addEventListener('change', function() {
                document.getElementById('urlField').style.display = this.value === 'local_folder' ? 'none' : 'block';
                document.getElementById('pathField').style.display = this.value === 'local_folder' ? 'block' : 'none';
            });
            typeSelect.dispatchEvent(new Event('change'));
        });

        loadConfig();
    </script>
</body>
</html>
